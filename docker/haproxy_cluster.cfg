global
  log localhost local1 notice
  maxconn 20000
  daemon

defaults
  log global
  mode tcp
  retries 3
  option tcpka
  option tcp-check
  timeout client 30s
  timeout server 30s
  timeout connect 5s

listen stats
  bind *:1936
  mode http
  log global

  maxconn 10
  timeout client 100s
  timeout server 100s
  timeout connect 100s
  timeout queue 100s

  stats enable
  stats uri /haproxy?stats
  stats realm HAProxy\ Statistics
  stats admin if TRUE
  stats show-node

listen elasticsearch
  bind *:9200
  mode http
  balance roundrobin
  option httpchk
  http-check send meth GET uri /_cluster/health
  http-check expect status 200
  server elasticsearchc01 elasticsearchc01:9200 check inter 2s on-marked-down shutdown-sessions
  server elasticsearchc02 elasticsearchc02:9200 check inter 2s on-marked-down shutdown-sessions
  server elasticsearchc03 elasticsearchc03:9200 check inter 2s on-marked-down shutdown-sessions

listen cockroachdb
  bind *:27257
  mode tcp
  option tcplog
  option tcpka
  balance roundrobin
  server cockroachc01 cockroachc01:26257 check inter 2s on-marked-down shutdown-sessions
  server cockroachc02 cockroachc02:26257 check inter 2s on-marked-down shutdown-sessions
  server cockroachc03 cockroachc03:26257 check inter 2s on-marked-down shutdown-sessions

listen cockroachdb_http
  bind *:8080
  mode tcp
  option tcplog
  option tcpka
  balance roundrobin
  server cockroachc01 cockroachc01:8080 check inter 2s on-marked-down shutdown-sessions
  server cockroachc02 cockroachc02:8080 check inter 2s on-marked-down shutdown-sessions
  server cockroachc03 cockroachc03:8080 check inter 2s on-marked-down shutdown-sessions

listen etcd
  bind *:2379
  mode tcp
  option tcplog
  option tcpka
  balance roundrobin
  server etcdc01 etcdc01:2379 check inter 2s on-marked-down shutdown-sessions
  server etcdc02 etcdc02:2379 check inter 2s on-marked-down shutdown-sessions
  server etcdc03 etcdc03:2379 check inter 2s on-marked-down shutdown-sessions
